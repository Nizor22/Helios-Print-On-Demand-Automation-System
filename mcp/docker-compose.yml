version: '3.8'

services:
  helios-mcp:
    build: .
    ports:
      - "8080:8080"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GOOGLE_CLOUD_PROJECT=${GOOGLE_CLOUD_PROJECT}
      - GOOGLE_SERVICE_ACCOUNT_JSON=${GOOGLE_SERVICE_ACCOUNT_JSON}
      - GOOGLE_DRIVE_FOLDER_ID=${GOOGLE_DRIVE_FOLDER_ID}
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: Add a simple test client
  test-client:
    image: curlimages/curl:latest
    depends_on:
      - helios-mcp
    command: >
      sh -c "
        echo 'Waiting for MCP server...' &&
        sleep 10 &&
        curl -X GET http://helios-mcp:8080/health &&
        echo 'Testing MCP tools...' &&
        curl -X POST http://helios-mcp:8080/execute \
          -H 'Content-Type: application/json' \
          -d '{\"tool\": \"orchestrator_ai\", \"parameters\": {\"prompt\": \"Test prompt\"}}'
      "
